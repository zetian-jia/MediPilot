# 更新日志 (Changelog)

本文档记录 MediPilot 项目的所有重要变更。

格式遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [v1.1.0] - 2026-01-08

### ✨ 新增 (Added)

#### 文档体系
- 📚 添加完整的用户使用手册 (`docs/USER_GUIDE.md`)
  - 详细的安装指南和系统要求
  - 配置说明和使用流程
  - 常见问题与故障排除
  - 典型使用场景示例

- 📚 添加开发者文档 (`docs/DEVELOPMENT.md`)
  - 项目架构深度解析
  - 完整的代码审查报告
  - 核心模块详解
  - 扩展开发指南
  - 测试与调试技巧
  - 性能优化建议

- 📚 添加 API 参考文档 (`docs/API_REFERENCE.md`)
  - 所有类和方法的详细说明
  - 参数和返回值规范
  - 完整的代码示例
  - 数据结构定义

#### 测试框架
- ✅ 添加配置系统单元测试 (`tests/test_config.py`)
  - 配置验证测试
  - 默认值测试
  - 异常处理测试

- ✅ 添加感知层单元测试 (`tests/test_perception.py`)
  - 截屏功能测试
  - 隐私过滤测试
  - SoM网格叠加测试
  - 完整流程测试

- ✅ 添加 pytest 配置文件 (`tests/conftest.py`)
  - 全局 fixtures
  - 测试环境配置
  - 模拟数据生成器

### 🔧 改进 (Changed)

#### 配置系统增强
- 🔐 添加完整的类型注解 (`configs/settings.py`)
- ✅ 实现配置验证方法 `Config.validate()`
  - API密钥格式验证
  - 日志级别验证
  - 时间参数验证
  - 隐私区域坐标验证
  - 模型名称验证

- 📊 添加配置信息显示方法 `Config.display_info()`
  - 脱敏显示API密钥
  - 展示所有关键配置项

- 🎯 添加自定义异常类 `ConfigError`

#### 感知层优化
- 🔐 添加完整的类型注解 (`medipilot/perception/screen.py`)
- ✅ 增强错误处理机制
  - 添加自定义异常 `PerceptionError`
  - 截屏失败时的异常处理
  - 隐私过滤失败时的降级处理
  - 网格绘制失败时的异常处理

- 🛡️ 改进隐私过滤逻辑
  - 验证隐私区域边界
  - 处理超出图像范围的情况
  - 确保ROI非空
  - 即使失败也返回原图并记录警告

- 📏 改进SoM网格叠加
  - 验证网格大小参数
  - 自动调整无效参数
  - 创建图像副本避免修改原图
  - 增强调试日志

#### 认知层优化
- 🔐 添加完整的类型注解 (`medipilot/cognition/engine.py`)
- ✅ 增强API调用错误处理
  - 添加自定义异常 `CognitionError`
  - 细分错误类型（rate_limit, connection, api, json）
  - 为不同错误类型返回详细信息
  - 添加30秒超时设置

- 🔍 改进返回结果验证
  - 检查必要字段是否存在
  - 记录警告信息
  - 增强调试日志

#### 执行层优化
- 🔐 添加完整的类型注解 (`medipilot/execution/action.py`)
- ✅ 添加坐标验证方法 `_validate_coordinate()`
  - 格式验证
  - 边界检查
  - 详细的错误日志

- 🎯 增强动作执行逻辑
  - 添加自定义异常 `ExecutionError`
  - 改进错误状态处理
  - 支持更多动作类型（scroll, wait）
  - 根据错误类型智能重试
  - 更友好的成功提示

- 🔒 增强安全性
  - 获取并缓存屏幕尺寸
  - 所有坐标操作前验证
  - 更详细的审计日志

#### 主程序优化
- 🔐 添加完整的类型注解 (`main.py`)
- ✅ 重构主程序流程
  - 添加配置验证环节
  - 改进初始化错误处理
  - 添加迭代计数器防止无限循环
  - 增强异常捕获和日志记录
  - 更友好的用户界面

- 📊 添加启动信息显示
  - 显示项目标题
  - 展示配置信息
  - 记录迭代次数

- 🛡️ 改进安全性
  - 最大迭代次数限制（100次）
  - 分阶段错误处理
  - 每个阶段独立的try-except
  - 智能重试机制

### 📝 文档更新 (Documentation)

- 📖 更新主 README.md
  - 添加完整文档链接
  - 添加快速链接部分
  - 更新联系方式
  - 添加最后更新时间

- 📋 创建更新日志 (CHANGELOG.md)

### 🏗️ 技术债务清理 (Technical Debt)

- ♻️ 统一异常处理模式
- 📝 完善类型注解覆盖率
- ✅ 建立单元测试基础
- 📊 增强日志记录粒度

---

## [v1.0.0] - 2026-01-07

### ✨ 初始发布

#### 核心功能
- 🩺 三层架构设计（感知-认知-执行）
- 📸 高性能屏幕截图
- 🔒 本地隐私过滤（PII脱敏）
- 👁️ SoM视觉锚点技术
- 🤖 多模态大模型集成
- 🖱️ GUI自动化操作
- 📝 审计日志系统

#### 安全机制
- ⚠️ 法律免责声明
- 🛑 紧急熔断机制（FAILSAFE）
- ⏱️ 动作限速
- 🔐 API密钥管理

#### 医疗特性
- 💊 医疗术语映射
- 📋 临床专用Prompt
- 🏥 检验数据提取
- 📊 结构化输出

---

## 版本说明

### 版本号格式
- **MAJOR**: 重大变更，不向后兼容
- **MINOR**: 新功能，向后兼容
- **PATCH**: Bug修复，向后兼容

### 变更类型
- `Added`: 新增功能
- `Changed`: 功能变更
- `Deprecated`: 即将废弃的功能
- `Removed`: 已移除的功能
- `Fixed`: Bug修复
- `Security`: 安全相关

---

**项目维护者**: Zetian Jia  
**最后更新**: 2026-01-08